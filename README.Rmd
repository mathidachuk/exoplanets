---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# exoplanets <img src="man/figures/logo.png" align="right" height=150/>

<!-- badges: start -->
[![Travis build status](https://travis-ci.org/tyluRp/exoplanets.svg?branch=master)](https://travis-ci.org/tyluRp/exoplanets)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/tyluRp/exoplanets?branch=master&svg=true)](https://ci.appveyor.com/project/tyluRp/exoplanets)
[![R build status](https://github.com/tyluRp/exoplanets/workflows/R-CMD-check/badge.svg)](https://github.com/tyluRp/exoplanets)
[![Codecov test coverage](https://codecov.io/gh/tyluRp/exoplanets/branch/master/graph/badge.svg)](https://codecov.io/gh/tyluRp/exoplanets?branch=master)
<!-- badges: end -->

The goal of exoplanets is to provide access to [NASA's Exoplanet Archive](https://exoplanetarchive.ipac.caltech.edu/index.html) database in R. The functionality of this package is fairly minimal and is simply an R interface to access exoplanet data in the following ways:

* By providing a table name using `exo`
* By providing a query URL using `exo_raw`
* By summarising the database using `exo_summary`

```{r, echo=FALSE, message=FALSE, dpi=300, fig.height=4}
# library(ggplot2)
# library(tidyr)
# library(dplyr)
# library(RColorBrewer)
# 
# exoplanets <- exo::exo() %>% 
#   as_tibble()
# 
# ggexoplanets <- exoplanets %>% 
#   select(pl_bmassj, pl_orbper, pl_discmethod) %>% 
#   drop_na() 
# 
# # cols_vec <- randomcoloR::distinctColorPalette(length(unique(ggexoplanets$pl_discmethod)))
# 
# exoplanets <- exo::exo() %>% 
#   as_tibble()
# 
# cols_vec <- c("#86E57B", "#77AFD7", "#DCD955", "#CFD49C", "#D5CCD1", "#84DECA", "#E15AB9", "#D4816C", "#BA91D1", "#A152DF")
# 
# exoplanets %>% 
#   select(pl_name, pl_bmassj, pl_orbper, pl_discmethod) %>% 
#   drop_na(pl_bmassj, pl_orbper, pl_discmethod) %>% 
#   arrange(pl_name) %>% 
#   ggplot(aes(pl_orbper, pl_bmassj)) +
#   geom_point(aes(fill = pl_discmethod), color = "black", shape = 21, size = 2) +
#   scale_x_log10(
#     breaks = scales::trans_breaks("log10", function(x) 10^x),
#     labels = scales::trans_format("log10", scales::math_format(10^.x))
#   ) +
#   scale_y_log10(
#     breaks = scales::trans_breaks("log10", function(x) 10^x),
#     labels = scales::trans_format("log10", scales::math_format(10^.x))
#   ) +
#   labs(
#     x = "Period (days)",
#     y = "Mass (Jupiter Masses)",
#     fill = "Discovery Method"
#   ) +
#   annotation_logticks() +
#   scale_fill_manual(values = cols_vec) +
#   guides(fill = guide_legend(override.aes = list(size = 4))) +
#   geom_curve(aes(x = 100, y = 0.00070, xend = 6.0996151 + 0.6, yend = 0.00194 - 0.0002), 
#              colour = "#555555", 
#              size = 0.5, 
#              curvature = -0.2,
#              arrow = arrow(length = unit(0.03, "npc"))) + 
#   geom_label(aes(x = 100, y = 0.00070, label = "TRAPPIST-1 e"), 
#              hjust = 0, 
#              vjust = 0.5, 
#              label.size = NA, 
#              family = "SFProText-Regular", 
#              size = 5) +
#   theme_bw() +
#   theme(
#     text = element_text(family = "SFProText-Regular"),
#     plot.caption = element_text(family = "SFProText-RegularItalic"),
#     panel.grid = element_blank()
#   )

knitr::include_graphics("man/figures/README-unnamed-chunk-2-1.png")
```

## Installation

You can install the development version from GitHub with:

``` r
# install.packages("devtools")
devtools::install_github("tylurp/exoplanets")
```

## Example

This is a basic example which shows you how to access data from the exoplanet table:

```{r echo=FALSE}
library(exoplanets)
formals(exo)$progress <- FALSE
formals(exo_raw)$progress <- FALSE
formals(exo_column_names)$progress <- FALSE
```

```{r example, message=FALSE}
library(exoplanets)

exo(table = "exoplanets")
```

To access data from a different table you can use the table parameter: 

```{r}
exo(table = "keplernames")
```

To get a list of all available tables:

```{r}
names(exo_tables) 
```

To get a vector of column names for a specific table:

```{r}
default_names <- exo_column_names(
  table = "cumulative", 
  cols = "default"
  )

all_names <- exo_column_names(
  table = "cumulative", 
  cols = "all"
  )

str(default_names)
str(all_names)
```

To summarise the database, you can use `exo_summary`, which doesn't include everything found [here](https://exoplanetarchive.ipac.caltech.edu/docs/counts_detail.html) (yet) but might in the future. The default output is a list, you can override this with `output = "dataframe"`:

```{r}
db_summary <- exo_summary(output = "dataframe", progress = FALSE)
str(db_summary)
```


Finally, you can take a look at the [docs](https://exoplanetarchive.ipac.caltech.edu/docs/program_interfaces.html) and use `eco_raw` to write out queries in their entirety. Spaces and single quotes will be escaped automatically. The only supported format is CSV so do not request JSON, ipac, or others:

```{r}
x <- c(
  base = "https://exoplanetarchive.ipac.caltech.edu/cgi-bin/nstedAPI/nph-nstedAPI?",
  table = "table=exoplanets",
  columns = "&select=pl_hostname,ra,dec",
  parameters = "&order=dec"
)

query <- paste(x, collapse = "")

exo_raw(query)
```

## Contributing

Please note that the 'exoplanets' project is released with a
[Contributor Code of Conduct](CODE_OF_CONDUCT.md).
By contributing to this project, you agree to abide by its terms.
